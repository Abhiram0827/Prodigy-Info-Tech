import pandas as pd
import numpy as np
import seaborn as sns
import matplotlib.pyplot as plt

# Load Titanic dataset from a local CSV file (instead of sns.load_dataset)
file_path = "titanic.csv"  # Ensure the file exists in your working directory
df = pd.read_csv(file_path)

# Display basic info
df.info()
print(df.head())

# Handling missing values
df.drop(columns=["deck"], errors='ignore', inplace=True)  # Too many missing values
df["age"].fillna(df["age"].median(), inplace=True)  # Fill missing ages with median
df["embark_town"].fillna(df["embark_town"].mode()[0], inplace=True)  # Fill with mode
df["embarked"].fillna(df["embarked"].mode()[0], inplace=True)
df["fare"].fillna(df["fare"].median(), inplace=True)

# Convert categorical variables
df = pd.get_dummies(df, columns=["sex", "class", "embarked"], drop_first=True)

# Summary statistics
print(df.describe())

# Visualizing survival rate
plt.figure(figsize=(6, 4))
sns.countplot(x="survived", data=df, palette="coolwarm")
plt.title("Survival Count")
plt.show()

# Survival rate by gender
plt.figure(figsize=(6, 4))
sns.barplot(x="sex_male", y="survived", data=df, ci=None, palette="coolwarm")
plt.title("Survival Rate by Gender")
plt.xlabel("Male (1) / Female (0)")
plt.ylabel("Survival Rate")
plt.show()

# Survival rate by class
plt.figure(figsize=(6, 4))
sns.barplot(x="class_Second", y="survived", data=df, ci=None, color="blue", label="Second Class")
sns.barplot(x="class_Third", y="survived", data=df, ci=None, color="red", label="Third Class")
plt.title("Survival Rate by Class")
plt.xlabel("Class (First=0, Second=1, Third=1)")
plt.ylabel("Survival Rate")
plt.legend()
plt.show()

# Correlation heatmap
plt.figure(figsize=(10, 6))
sns.heatmap(df.corr(), annot=True, cmap="coolwarm", fmt=".2f", linewidths=0.5)
plt.title("Feature Correlation Matrix")
plt.show()
